# 临时文件清理功能实现总结

## 问题描述
用户反馈在Windows环境下，程序运行后在 `C:\Users\86153\AppData\Roaming\com.ganily.archivebox\ArchiveBox\batches` 目录下存在大量以 `batches_` 开头的文件夹，占用大量空间。希望在关闭程序时或重新加载其他ZIP时能够清除这些临时文件。

## 解决方案

### 1. 应用关闭时自动清理
- 在 `tauri::Builder` 中添加了 `on_window_event` 监听器
- 当检测到 `CloseRequested` 事件时，自动调用清理函数
- 清理所有批次目录下的临时文件

### 2. 手动清理功能
- 在工具栏添加红色的"清理临时文件"按钮
- 提供确认对话框防止误操作
- 显示清理释放的磁盘空间大小
- 清理后重置界面状态

### 3. 智能批次管理
- 在导入新ZIP时自动清理旧批次
- 保留最近3个批次，删除更早的批次
- 避免临时文件无限制增长

## 代码修改

### 后端 (src-tauri/src/lib.rs)
1. 添加了清理相关的Tauri命令：
   - `cleanup_temp_files` - 手动清理
   - `cleanup_old_batches` - 清理旧批次

2. 实现了清理功能函数：
   - `cleanup_temp_files_on_exit()` - 应用关闭时清理
   - `cleanup_old_batches_internal()` - 内部清理逻辑
   - `calculate_dir_size()` - 计算目录大小

3. 在 `import_zips` 函数中添加自动清理旧批次的逻辑

### 前端 (frontend/)
1. **HTML** (index.html): 添加清理按钮和工具栏分隔符
2. **JavaScript** (main.js): 添加清理按钮的事件处理逻辑
3. **CSS** (style.css): 添加清理按钮的红色警告样式

## 功能特点

- **安全性**: 提供确认对话框防止误操作
- **智能化**: 自动管理批次数量，避免无限增长
- **用户友好**: 显示清理结果和释放的空间大小
- **完整性**: 清理后重置界面状态，保持一致性

## 使用效果

用户现在可以：
1. 通过红色按钮手动清理临时文件
2. 关闭应用时自动清理所有临时文件
3. 导入新ZIP时自动清理旧批次
4. 查看清理释放的磁盘空间大小

这个功能有效解决了Windows环境下临时文件占用大量磁盘空间的问题。