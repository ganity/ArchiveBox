# 临时文件清理功能测试指南

## 功能说明

已为项目添加了临时文件清理功能，可以有效管理Windows环境下的临时文件占用问题。

## 新增功能

### 1. 自动清理（应用关闭时）
- 当用户关闭应用程序时，会自动清理所有临时文件
- 清理位置：`C:\Users\[用户名]\AppData\Roaming\com.ganily.archivebox\ArchiveBox\batches`

### 2. 手动清理按钮
- 在工具栏添加了红色的"清理临时文件"按钮
- 点击后会弹出确认对话框
- 清理完成后会显示释放的磁盘空间大小
- 清理后界面会重置，需要重新导入ZIP文件

### 3. 智能批次管理
- 导入新ZIP时自动清理旧批次，保留最近3个批次
- 避免临时文件无限制增长

## 技术实现

### 后端功能（Rust）
1. `cleanup_temp_files_on_exit()` - 应用关闭时清理
2. `cleanup_temp_files()` - 手动清理命令
3. `cleanup_old_batches()` - 清理旧批次命令
4. `cleanup_old_batches_internal()` - 内部清理逻辑
5. `calculate_dir_size()` - 计算目录大小

### 前端功能（JavaScript）
1. 添加清理按钮的事件处理
2. 确认对话框防止误操作
3. 清理后重置界面状态
4. 显示清理结果和释放空间

### 样式设计（CSS）
1. 红色警告色按钮样式
2. 工具栏分隔符
3. 悬停和禁用状态样式

## 使用方法

### 手动清理
1. 点击工具栏中的红色"清理临时文件"按钮
2. 在确认对话框中点击"确定"
3. 等待清理完成，查看释放的空间大小
4. 重新导入需要的ZIP文件

### 自动清理
- 正常关闭应用程序即可自动清理
- 无需手动操作

## 注意事项

1. **数据安全**：清理操作会删除所有已导入的数据，请确保重要文件已导出
2. **确认操作**：手动清理前会弹出确认对话框，请仔细阅读
3. **重新导入**：清理后需要重新导入ZIP文件才能继续使用
4. **磁盘空间**：清理后会立即释放磁盘空间，特别是大量视频文件占用的空间

## 测试建议

1. 导入一些ZIP文件，观察临时目录大小
2. 点击清理按钮，确认功能正常
3. 重新导入文件，验证功能完整性
4. 关闭应用，检查临时文件是否被清理

这个功能将有效解决Windows环境下临时文件占用大量磁盘空间的问题。